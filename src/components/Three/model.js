/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import React, { useRef } from 'react'
import { useFrame } from 'react-three-fiber';
import { useGLTF } from '@react-three/drei'

const getAngle = (p1, p2) => {
  //if(p1['score'] > 0.3){
  return Math.atan2(p2['position']['y'] - p1['position']['y'], p2['position']['x'] - p1['position']['x']);
  //}
  //return 0
}

export default function Model(props) {
  let kp;
  const group = useRef()
  const { nodes, materials } = useGLTF('../../../model.glb')

  console.log(nodes.Ch36.skeleton)

  kp = props.getJoints()
  console.log(kp)
  

  useFrame((state, delta) => {
    const coords = {x: 10, y: 10}
    kp = props.getJoints()
  
    nodes.Ch36.skeleton.bones[7].rotation.y = - getAngle(kp[5], kp[7])
    nodes.Ch36.skeleton.bones[31].rotation.y = - getAngle(kp[8], kp[6])
    nodes.Ch36.skeleton.bones[9].rotation.x = getAngle(kp[7], kp[9])
    nodes.Ch36.skeleton.bones[33].rotation.x = -getAngle(kp[10], kp[8])
    //nodes.Ch36.skeleton.bones[55].rotation.z =  -getAngle(kp[13], kp[11])+ 3.14/2
    nodes.Ch36.skeleton.bones[60].rotation.z =  -getAngle(kp[14], kp[12])+ 3.14/2

    //moveJoint(nodes.Ch36.skeleton.bones[0], coords)
  })

  return (
    <group ref={group} {...props} dispose={null}>
      <group name="Armature" rotation={[Math.PI / 2, 0, 0]} scale={[0.01, 0.01, 0.01]}>
        <primitive object={nodes.mixamorig1Hips} />
        <skinnedMesh geometry={nodes.Ch36.geometry} material={materials.Ch36_Body} skeleton={nodes.Ch36.skeleton} />
      </group>
    </group>
  )
}

useGLTF.preload('../../../model.glb')